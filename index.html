<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Controle de Estoque</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      text-align: center;
    }

    input{
      text-align: center;
      width: 30%;
    }
  
  
    .BTN {
      width: fit-content;
      font-size: 10px;
      padding: 10px;
      justify-content: space-evenly;
    }
  
    button {
      width: fit-content;
      border-radius: 5px;
      font-size: 80%;
      padding: 10px;
      color: white;
      background: green;
      border: 1px black;
    }
    
    .botoes{
      margin: 0 auto;
      align-items: center;
      background:grey;
      display: flex;
      gap: 10px;
      width: fit-content;
      height: fit-content;
    }
    
    tbody button{
      margin: 5px;
      justify-content: space-evenly;
      gap: 10px;
      background: blue;
      width: 40px;
    }
  
    /* Tables */
    table,
    th,
    td {
      font-size: 1rem;
      text-align: center;
      background-color: darkgray;
      margin: 0 auto;
      border-bottom: 1px solid black;
     /* border-collapse: collapse;*/
      border-radius: 1px;
      padding: 5px;
    }
    
    td button{
      width: 30px;
      height: 30px;
      border-radius: 5px;
      text-align: center;
      justify-content: center;
    }
  
    /* Headings */
    h1 {
      font-size: 40px;
    }
  
    h2 {
      font-size: 30px;
    }
  
    /* Excluir button */
    #excluir {
      width: fit-content;
      padding: 8px;
    }
  
    /* Tabs */
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
    }
    
    table#retirada{
      background: white;
    }
    
    .acoes{
      display: flex;
    }
    
  
    /* Content */
    #habilitar{
      width: fit-content;
    }
    
    
    #habilitar input{
      width: fit-content;
    }
    
    select{
      width: 100%;
      text-align: center;
    }

  </style>
  
</head>
<body>
  <h1>CONTROLE DE ESTOQUE</h1>
  
  <div class="botoes" >

  <button class="BTN" onclick="mostrarRetirada()">Retirada do Estoque</button>
  <button class="BTN" onclick="mostrarEstoque()">Estoque Atual</button>
  <button class="BTN" type="button" id="clear-storage-btn">Resetar estoque</button>
 </div>

  <div id="estoqueDiv" style="display: none;">
    
  
  <table id="estoque">
    <h2>Estoque Atual</h2>
    <tr>
      <th>Quantidade</th>
      <th>Ações</th>
    </tr>
  </table>
  <br>
  <button class="BTN" onclick="adicionar()">Adicionar Produto</button>
  </div>

  <br><br>


<table style="display: block" id="habilitar">
<tr>
  <th>Técnico:</th>
  <td>
    <select id="tecnico">
      <option disabled selected value="">Selecione o técnico</option>
      <option value="Andre">André</option>
      <option value="Elvis">Elvis</option>
      <option value="Guilherme">Guilherme</option>
      <option value="Robson">Robson</option>
      <option value="Sergio">Sérgio</option>
      
    </select>
  </td>
</tr>

  <tr>
    <th>Cliente:</th>
    <td><input type="text" placeholder="Nome do Cliente" id="cliente"></td>
  </tr>
  <tr>
    <th>Fibra metragem:</th>
    <td><input type="number" placeholder="00" onchange="atualizarQuantidadeRetirada(0, this.value)"  id="fibraMetragem"  ></td>
  </tr>
  <tr>
    <th>CTO:</th>
    <td><input placeholder="00" type="number" id="cto"></td>
  </tr>
  
 <tr>
  <th>Porta:</th>
  <td>
    <select id="porta" >
      <option disabled selected value="">Selecione a porta</option>
      <option value="01">Porta 01</option>
      <option value="02">Porta 02</option>
      <option value="03">Porta 03</option>
      <option value="04">Porta 04</option>
      <option value="05">Porta 05</option>
      <option value="06">Porta 06</option>
      <option value="07">Porta 07</option>
      <option value="08">Porta 08</option>
      <option value="09">Porta 09</option>
      <option value="10">Porta 10</option>
      <option value="11">Porta 11</option>
      <option value="12">Porta 12</option>
      <option value="13">Porta 13</option>
      <option value="14">Porta 14</option>
      <option value="15">Porta 15</option>
      <option value="16">Porta 16</option>
    </select>
  </td>
</tr>

  <tr>
    <th>Sinal CTO:</th>
    <td><input type="number" placeholder="-00.00" id="sinalCto"></td>
  </tr>
  <tr>
    <th>Sinal Cliente:</th>
    <td><input type="number" placeholder="-00.00" id="sinalCliente"></td>
  </tr>
  <tr>
    <th>SC-APC:</th>
    <td><input type="number" placeholder="00" id="scApc" onchange="atualizarQuantidadeRetirada(1, this.value)" ></td>
  </tr>
  <tr>
    <th>SC-UPC:</th>
    <td><input type="number" placeholder="00" id="scUpc" onchange="atualizarQuantidadeRetirada(2, this.value)" ></td>
  </tr>
  <tr>
    <th>Esticadores:</th>
    <td><input type="number" placeholder="00" id="esticadores" onchange="atualizarQuantidadeRetirada(3, this.value)" ></td>
  </tr>
  <tr>
    <th>Roldana:</th>
    <td><input type="number" placeholder="00" id="roldana" onchange="atualizarQuantidadeRetirada(4, this.value)" ></td>
  </tr>
  <tr>
    <th>Fecho:</th>
    <td><input type="number" placeholder="00" id="fecho" onchange="atualizarQuantidadeRetirada(5, this.value)" ></td>
  </tr>
  <tr>
    <th>Anel:</th>
    <td><input type="number" placeholder="00" id="anel" onchange="atualizarQuantidadeRetirada(6, this.value)" ></td>
  </tr>
  <tr>
    <th>Fita aço:</th>
    <td><input type="number" placeholder="00" id="fitaAco" onchange="atualizarQuantidadeRetirada(7, this.value)" ></td>
  </tr>
  <tr>
    <th>Fixa fio:</th>
    <td><input type="number" placeholder="00" id="fixaFio" onchange="atualizarQuantidadeRetirada(8, this.value)" ></td>
  </tr>
  <tr>
    <th>Isolante:</th>
    <td><input type="number" placeholder="00" id="isolante" onchange="atualizarQuantidadeRetirada(9, this.value)" ></td>
  </tr>
  <tr>
    <th>Cabo de rede:</th>
    <td><input type="number" placeholder="00" id="caboRede" onchange="atualizarQuantidadeRetirada(10, this.value)" ></td>
  </tr>
  <tr>
    <th>Conc RJ45:</th>
    <td><input type="number" placeholder="00" id="concRj45" onchange="atualizarQuantidadeRetirada(11, this.value)" ></td>
  </tr>
  <tr>
    <th>Kit fusão:</th>
    <td><input type="number" placeholder="00" id="kitFusao" onchange="atualizarQuantidadeRetirada(12, this.value)" ></td>
  </tr>
  <tr>
</table>


  
  
  
  <div id="retiradaDiv" style="display: block;">
  <table id="retirada">
    <h2>Retirada de Estoque</h2>
    <tr>
      <th>Produto</th>
      <th>Quantidade</th>
      <th>Ações</th>
    </tr>
  </table>
  <br>
  <button class="BTN"  onclick="enviar()">Enviar</button>
  <input type="text" id="clipboardInput" style="position: absolute; left: -9999px;">

  </div>

  <script>
  
const clearStorageBtn = document.querySelector("#clear-storage-btn");

clearStorageBtn.addEventListener("click", () => {
  const confirmReset = confirm("Você tem certeza que deseja resetar o estoque?");

  if (confirmReset) {
    localStorage.clear();
    alert("Estoque resetado com sucesso!");
  }
});




    // Função para exibir a seção do estoque e ocultar a seção de retirada
    function mostrarEstoque() {
      document.getElementById("estoqueDiv").style.display = "block";
      document.getElementById("retiradaDiv").style.display = "none";
      
      document.getElementById("habilitar").style.display = "block";
      document.getElementById("habilitar").style.display = "none";
    }


    // Função para exibir a seção de retirada e ocultar a seção do estoque
    function mostrarRetirada() {
      document.getElementById("estoqueDiv").style.display = "none";
      document.getElementById("retiradaDiv").style.display = "block";
      
      document.getElementById("habilitar").style.display = "none";
      document.getElementById("habilitar").style.display = "block";
      
    }
    
    

    // Variáveis para armazenar os produtos e retiradas, utilizando o armazenamento local (localStorage)
    let produtos = JSON.parse(localStorage.getItem("produtos")) || [
 { nome: "DROP", quantidade: 1000 },
 { nome: "SC-APC", quantidade: 20 },
 { nome: "SC-UPC", quantidade: 20 },
 { nome: "Esticadores", quantidade: 100 },
 { nome: "Roldana", quantidade: 100 },
 { nome: "Fecho", quantidade: 50 },
 { nome: "Anel", quantidade: 50 },
 { nome: "Fita aço", quantidade: 50 },
 { nome: "Fixa fio", quantidade: 100 },
 { nome: "Cabo de rede", quantidade: 300 },
 { nome: "Conc RJ45", quantidade: 20 },
    ];



    let retirada = JSON.parse(localStorage.getItem("retirada")) || [];


    // Função para atualizar a tabela de estoque com os produtos e suas quantidades
    function atualizarTabelaEstoque() {
      let tabela = document.getElementById("estoque");
      tabela.innerHTML = "<tr><th>Produto</th><th>Quantidade</th><th>Ações</th></tr>";
      for (let i = 0; i < produtos.length; i++) {
        let linha = tabela.insertRow(-1);
        let celulaNome = linha.insertCell(0);
        let celulaQuantidade = linha.insertCell(1);
        let celulaAcoes = linha.insertCell(2);
        celulaNome.innerHTML = produtos[i].nome;
        celulaQuantidade.innerHTML = `<input type="number" min="0" value="${produtos[i].quantidade}" onchange="atualizarQuantidadeEstoque(${i}, this.value)">`;
        celulaAcoes.innerHTML = `<div class='acoes'><button onclick="aumentarEstoque(${i})">+</button> <button onclick="diminuirEstoque(${i})">-</button> <button id="excluir" onclick="excluir(${i})">Excluir</button></div>`;
      }
    }
    
    
    

    // Função para atualizar a tabela de retirada com os produtos e suas quantidades
    function atualizarTabelaRetirada() {
      let tabela = document.getElementById("retirada");
      tabela.innerHTML = "<tr><th>Produto</th><th>Quantidade</th><th>Ações</th></tr>";
      for (let i = 0; i < retirada.length; i++) {
        let linha = tabela.insertRow(-1);
        let celulaNome = linha.insertCell(0);
        let celulaQuantidade = linha.insertCell(1);
        let celulaAcoes = linha.insertCell(2);
        celulaNome.innerHTML = retirada[i].nome;
        celulaQuantidade.innerHTML = `<input type="number" min="0" value="${retirada[i].quantidade}" onchange="atualizarQuantidadeRetirada(${i}, this.value)">`;
        celulaAcoes.innerHTML = `<div class="acoes"><button onclick="aumentarRetirada(${i})">+</button> <button onclick="diminuirRetirada(${i})">-</button><div>`;
      }
    }

    // Função para aumentar a quantidade de um produto no estoque
    function aumentarEstoque(indice) {
      produtos[indice].quantidade++;
      atualizarTabelaEstoque();
      salvarDados();
    }

    // Função para diminuir a quantidade de um produto no estoque
    function diminuirEstoque(indice) {
      if (produtos[indice].quantidade > 0) {
        produtos[indice].quantidade--;
        atualizarTabelaEstoque();
        salvarDados();
      }
    }

    // Função para aumentar a quantidade de um produto na retirada
    function aumentarRetirada(indice) {
      retirada[indice].quantidade++;
      atualizarTabelaRetirada();
      salvarDados();
    }

    
    // Função para diminuir a quantidade de um produto na retirada
    function diminuirRetirada(indice) {
      if (retirada[indice].quantidade > 0) {
        retirada[indice].quantidade--;
        atualizarTabelaRetirada();
        salvarDados();
      }
    }

    // Função para adicionar um novo produto ao estoque e à retirada
    function adicionar() {
      let nome = prompt("Nome do produto:");
      if (nome) {
        produtos.push({ nome, quantidade: 0 });
        retirada.push({ nome, quantidade: 0 });
        atualizarTabelaEstoque();
        atualizarTabelaRetirada();
        salvarDados();
      }
    }

    // Função para excluir um produto do estoque e da retirada
    function excluir(indice) {
      let nome = produtos[indice].nome;
      produtos.splice(indice, 1);
      for (let i = 0; i < retirada.length; i++) {
        if (retirada[i].nome === nome) {
          retirada.splice(i, 1);
          break;
        }
      }
      atualizarTabelaEstoque();
      atualizarTabelaRetirada();
      salvarDados();
    }

// Função para processar a retirada de produtos
      function enviar() {
        for (let i = 0; i < retirada.length; i++) {
          let produtoRetirado = retirada[i];
          for (let j = 0; j < produtos.length; j++) {
            if (produtos[j].nome === produtoRetirado.nome) {
              produtos[j].quantidade -= produtoRetirado.quantidade;
              break;
            }
          }
          produtoRetirado.quantidade = 0;
        }
        
    
        atualizarTabelaEstoque();
        atualizarTabelaRetirada();
        salvarDados();
        
        // Chamar a função para copiar o conteúdo após o envio
        setTimeout(copiarConteudo, 200)}

// Função para copiar o conteúdo atualizado para a área de transferência
function copiarConteudo() {
  let copiado = '';


  
  
  //estrututa da 1• tabela (copiar)
  copiado += `#*Favor Habilitar*##Técnico: ${document.getElementById('tecnico').value}\n`;
copiado += `Cliente: ${document.getElementById('cliente').value}\n`;
copiado += `Fibra Metragem: ${document.getElementById('fibraMetragem').value}\n`;
copiado += `CTO: ${document.getElementById('cto').value}\n`;
copiado += `Porta: ${document.getElementById('porta').value}\n`;
copiado += `Sinal CTO: ${document.getElementById('sinalCto').value}\n`;
copiado += `Sinal Cliente: ${document.getElementById('sinalCliente').value}\n`;
copiado += `SC-APC: ${document.getElementById('scApc').value}\n`;
copiado += `SC-UPC: ${document.getElementById('scUpc').value}\n`;
copiado += `Esticadores: ${document.getElementById('esticadores').value}\n`;
copiado += `Roldana: ${document.getElementById('roldana').value}\n`;
copiado += `Fecho: ${document.getElementById('fecho').value}\n`;
copiado += `Anel: ${document.getElementById('anel').value}\n`;
copiado += `Fita aço: ${document.getElementById('fitaAco').value}\n`;
copiado += `Fixa fio: ${document.getElementById('fixaFio').value}\n`;
copiado += `Isolante: ${document.getElementById('isolante').value}\n`;
copiado += `Cabo de rede: ${document.getElementById('caboRede').value}\n`;
copiado += `Conc RJ45: ${document.getElementById('concRj45').value}\n`;
copiado += `Kit fusão: ${document.getElementById('kitFusao').value}##*Meu Estoque*#_____________#\n`;

  // Construir a string com a estrutura desejada, substituindo as quebras de linha pelo caractere "#"
  
  //esse é o que copia *favor habilitar
  for (let i = 0; i < produtos.length; i++) {
    copiado += `${produtos[i].nome}:${produtos[i].quantidade}#`;
  }

  // Substituir o "#" por quebras de linha (\n)
  copiado = copiado.replace(/#/g, '\n');

  // Exiba o conteúdo da variável 'copiado' no console
  console.log('Conteúdo Atualizado:', copiado);
  

  // Crie um elemento de input temporário
  const tempInput = document.createElement('textarea');
  tempInput.style.position = 'absolute';
  tempInput.style.left = '-9999px';
  tempInput.value = copiado;

  // Anexe o elemento de input ao corpo do documento
  document.body.appendChild(tempInput);

  // Selecione o texto no elemento de input
  tempInput.select();

  // Copie o texto para a área de transferência
document.execCommand('copy')

  // Remova o elemento de input temporário
  document.body.removeChild(tempInput);
    alert(copiado)
    
    
            document.getElementById("tecnico").selectedIndex = 0;
            document.getElementById("cliente").value = "Nome do Cliente";
            document.getElementById("fibraMetragem").value = "00";
            document.getElementById("cto").value = "00";
            document.getElementById("porta").selectedIndex = 0;
            document.getElementById("sinalCto").value = "-00.00";
            document.getElementById("sinalCliente").value = "-00.00";
            document.getElementById("scApc").value = "00";
            document.getElementById("scUpc").value = "00";
            document.getElementById("esticadores").value = "00";
            document.getElementById("roldana").value = "00";
            document.getElementById("fecho").value = "00";
            document.getElementById("anel").value = "00";
            document.getElementById("fitaAco").value = "00";
            document.getElementById("fixaFio").value = "00";
            document.getElementById("isolante").value = "00";
            document.getElementById("caboRede").value = "00";
            document.getElementById("concRj45").value = "00";
            document.getElementById("kitFusao").value = "00";
          
}




    function atualizarQuantidadeEstoque(indice, quantidade) {
      produtos[indice].quantidade = parseInt(quantidade);
      salvarDados();
    }

    function atualizarQuantidadeRetirada(indice, quantidade) {
      retirada[indice].quantidade = parseInt(quantidade);
      salvarDados();
    }

    function salvarDados() {
      localStorage.setItem("produtos", JSON.stringify(produtos));
      localStorage.setItem("retirada", JSON.stringify(retirada));
    }

    // Inicializa a tabela de retirada com os mesmos produtos da tabela de estoque
    if (retirada.length === 0) {
      for (let i = 0; i < produtos.length; i++) {
        retirada.push({ nome: produtos[i].nome, quantidade: 0 });
      }
    }

    atualizarTabelaEstoque();
    atualizarTabelaRetirada();
    
    document.getElementById("habilitar").addEventListener("submit", function(event) {
      event.preventDefault(); // Impede o envio padrão do formulário
      // Realiza a ação de envio aqui (por exemplo, enviar dados para o servidor)

    });
    
    // Obtém todos os elementos de entrada
var inputs = document.getElementsByTagName('input');

// Itera sobre todos os elementos de entrada e adiciona o manipulador de eventos
for (var i = 0; i < inputs.length; i++) {
  inputs[i].addEventListener('focus', clearInput);
}

// Função para limpar o valor do input
function clearInput(event) {
  event.target.value = '';
}


//Função para deixar negativo o sinal do cliente e da CTO mesmo se digitar ele positivo
var input = document.getElementById("sinalCto");
var input1 = document.getElementById("sinalCliente");

input.addEventListener('input', function() {
  if (parseFloat(input.value) >= 0) {
    input.value = '-' + input.value;
  }
});

input1.addEventListener('input', function() {
  if (parseFloat(input1.value) >= 0) {
    input1.value = '-' + input1.value;
  }
});

    
    
  </script>
</body>
</html>